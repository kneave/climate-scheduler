<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Climate Scheduler</title>
    <link rel="stylesheet" href="/climate_scheduler_panel/styles.css?v={{VERSION}}">
</head>
<body>
    <div class="container">
        <section class="entity-selector">
            <div class="selector-header">
                <h2>Climate Entities</h2>
                <button id="menu-button" class="btn-icon" title="Menu">⋮</button>
            </div>
            
            <div id="dropdown-menu" class="dropdown-menu" style="display: none;">
                <button id="refresh-entities-menu" class="menu-item">
                    <span class="menu-icon">↻</span>
                    <span>Refresh Entities</span>
                </button>
                <button id="sync-all-menu" class="menu-item">
                    <span class="menu-icon">⟲</span>
                    <span>Sync All Thermostats</span>
                </button>
            </div>
            
            <div class="active-section">
                <h3 class="section-title">Active (<span id="active-count">0</span>)</h3>
                <div id="entity-list" class="entity-list">
                    <!-- Dynamically populated -->
                </div>
            </div>
            
            <div class="groups-section">
                <h3 class="section-title">Groups (<span id="groups-count">0</span>)</h3>
                <div id="groups-list" class="groups-list">
                    <!-- Dynamically populated -->
                </div>
                <button id="create-group-btn" class="btn-primary" style="margin-top: 10px; width: 100%;">
                    + Create New Group
                </button>
            </div>
        </section>

        <section class="entity-selector ignored-entities-section">
            <div class="ignored-section">
                <button id="toggle-ignored" class="ignored-toggle">
                    <span class="toggle-icon">▶</span>
                    <span class="toggle-text">Ignored (<span id="ignored-count">0</span>)</span>
                </button>
                <div id="ignored-entity-list" class="entity-list ignored-list" style="display: none;">
                    <div class="filter-box">
                        <input type="text" id="ignored-filter" placeholder="Filter by name..." />
                    </div>
                    <div id="ignored-entities-container">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Confirmation Modal -->
        <div id="confirm-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Clear Schedule?</h3>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to clear the entire schedule for <strong id="confirm-entity-name"></strong>?</p>
                    <p>This action cannot be undone.</p>
                </div>
                <div class="modal-actions">
                    <button id="confirm-cancel" class="btn-secondary">Cancel</button>
                    <button id="confirm-clear" class="btn-danger">Clear Schedule</button>
                </div>
            </div>
        </div>

        <!-- Create Group Modal -->
        <div id="create-group-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create New Group</h3>
                </div>
                <div class="modal-body">
                    <label for="new-group-name">Group Name:</label>
                    <input type="text" id="new-group-name" placeholder="e.g., Bedrooms" style="width: 100%; padding: 8px; margin-top: 8px;" />
                </div>
                <div class="modal-actions">
                    <button id="create-group-cancel" class="btn-secondary">Cancel</button>
                    <button id="create-group-confirm" class="btn-primary">Create Group</button>
                </div>
            </div>
        </div>

        <!-- Add to Group Modal -->
        <div id="add-to-group-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add to Group</h3>
                </div>
                <div class="modal-body">
                    <p>Add <strong id="add-entity-name"></strong> to group:</p>
                    <select id="add-to-group-select" style="width: 100%; padding: 8px; margin-top: 8px; margin-bottom: 8px; background: var(--surface-light); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px;">
                        <!-- Populated dynamically -->
                    </select>
                    <p style="text-align: center; color: var(--text-secondary); margin: 8px 0;">or</p>
                    <input type="text" id="new-group-name-inline" placeholder="Create new group..." style="width: 100%; padding: 8px; background: var(--surface-light); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px;" />
                </div>
                <div class="modal-actions">
                    <button id="add-to-group-cancel" class="btn-secondary">Cancel</button>
                    <button id="add-to-group-confirm" class="btn-primary">Add to Group</button>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel collapsed">
            <div class="settings-header" id="settings-toggle">
                <h3>⚙️ Settings</h3>
                <span class="collapse-indicator">▼</span>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h4>Default Schedule</h4>
                    <p class="settings-description">Set the default temperature schedule used when clearing or creating new schedules</p>
                    
                    <div class="graph-container">
                        <svg id="default-schedule-graph" class="temperature-graph"></svg>
                    </div>
                    
                    <!-- Default Schedule Node Settings Panel -->
                    <div id="default-node-settings-panel" class="node-settings-panel" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4>Node Settings</h4>
                            <button id="default-delete-node-btn" class="btn-danger-outline" style="padding: 4px 12px; font-size: 0.9rem;">Delete Node</button>
                        </div>
                        <div class="node-info">
                            <span>Time: <strong id="default-node-time">--:--</strong></span>
                            <span>Temperature: <strong id="default-node-temp">--°C</strong></span>
                        </div>
                        
                        <div class="setting-item" id="default-hvac-mode-item">
                            <label for="default-node-hvac-mode">HVAC Mode:</label>
                            <select id="default-node-hvac-mode">
                                <option value="">-- No Change --</option>
                            </select>
                        </div>
                        
                        <div class="setting-item" id="default-fan-mode-item">
                            <label for="default-node-fan-mode">Fan Mode:</label>
                            <select id="default-node-fan-mode">
                                <option value="">-- No Change --</option>
                            </select>
                        </div>
                        
                        <div class="setting-item" id="default-swing-mode-item">
                            <label for="default-node-swing-mode">Swing Mode:</label>
                            <select id="default-node-swing-mode">
                                <option value="">-- No Change --</option>
                            </select>
                        </div>
                        
                        <div class="setting-item" id="default-preset-mode-item">
                            <label for="default-node-preset-mode">Preset Mode:</label>
                            <select id="default-node-preset-mode">
                                <option value="">-- No Change --</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Graph Options</h4>
                    <div class="setting-item">
                        <label for="tooltip-mode">Tooltip Display:</label>
                        <select id="tooltip-mode">
                            <option value="history">Show Historical Temperature</option>
                            <option value="cursor">Show Cursor Position</option>
                        </select>
                        <p class="settings-description" style="margin-top: 5px; font-size: 0.85rem;">Choose what information to display when hovering over the graph</p>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="reset-defaults" class="btn-secondary">Reset to Defaults</button>
                </div>
            </div>
        </div>

        <footer>
            <p id="version-info">Climate Scheduler v{{VERSION}}</p>
        </footer>
    </div>

    <script src="/climate_scheduler_panel/graph.js?v={{VERSION}}"></script>
    <script src="/climate_scheduler_panel/ha-api.js?v={{VERSION}}"></script>
    <script src="/climate_scheduler_panel/app.js?v={{VERSION}}"></script>
    <script>
        // Load version info dynamically
        fetch('/climate_scheduler_panel/version.json')
            .then(r => r.json())
            .then(data => {
                document.getElementById('version-info').textContent = 
                    `Climate Scheduler v${data.version}`;
            })
            .catch(() => {
                // Fallback if version endpoint fails
                console.warn('Could not load version info');
            });
    </script>
</body>
</html>

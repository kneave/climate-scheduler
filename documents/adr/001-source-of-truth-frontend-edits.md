# ADR-001: Source-of-Truth Editing Policy for Frontend Assets

- Status: Accepted
- Date: 2026-02-15
- Owners: Project maintainers
- Related files:
  - `rollup.config.mjs`
  - `src/*.ts`
  - `custom_components/climate_scheduler/frontend/app.js`
  - `custom_components/climate_scheduler/frontend/*.js`

## Context

The frontend combines compiled TypeScript components and a runtime JavaScript orchestration file. Editing compiled outputs directly can cause drift and accidental overwrite during build/deploy.

## Decision

- For compiled components, edit only `src/*.ts`.
- Treat generated files in `custom_components/climate_scheduler/frontend/*.js` as build artifacts when there is a matching TS source.
- `custom_components/climate_scheduler/frontend/app.js` remains a direct-edit runtime source (not generated by Rollup).

## Consequences

### Positive
- Reduces accidental divergence between source and artifact.
- Makes code review and troubleshooting deterministic.
- Keeps build/release behavior predictable.

### Negative
- Requires build step before validating some TS changes in deployed frontend.

## Alternatives Considered

1. Edit built files directly for faster tweaks
   - Rejected: high drift risk and poor maintainability.
2. Fully migrate runtime `app.js` into TS immediately
   - Deferred: larger refactor; not required for immediate stability.

## Rollout Notes

- Keep this rule referenced in `documents/CONTEXT_SNAPSHOT.md` and `documents/ARCHITECTURE_MAP.md`.
- During reviews, reject direct edits to generated files when TS source exists.

## Follow-ups

- Consider phased decomposition of `frontend/app.js` into TS modules in a future refactor plan.
